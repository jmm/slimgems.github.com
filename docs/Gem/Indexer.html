<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Gem::Indexer
  
    &mdash; Documentation by YARD 0.6.8
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (I)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Gem.html" title="Gem (module)">Gem</a></span></span>
     &raquo; 
    <span class="title">Indexer</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Gem::Indexer
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Gem::Indexer</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="UserInteraction.html" title="Gem::UserInteraction (module)">UserInteraction</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/rubygems/indexer.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Top level class for building the gem repository index.
</p>


  </div>
</div>
<div class="tags">
  
</div>

  
  
  
  
  
  
  
  
  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_legacy-instance_method" title="#build_legacy (instance method)">- (Object) <strong>build_legacy</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Build indexes for RubyGems older than 1.2.0 when true.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_modern-instance_method" title="#build_modern (instance method)">- (Object) <strong>build_modern</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Build indexes for RubyGems 1.2.0 and newer when true.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#dest_directory-instance_method" title="#dest_directory (instance method)">- (Object) <strong>dest_directory</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Index install location.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#dest_latest_specs_index-instance_method" title="#dest_latest_specs_index (instance method)">- (Object) <strong>dest_latest_specs_index</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Latest specs index install location.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#dest_prerelease_specs_index-instance_method" title="#dest_prerelease_specs_index (instance method)">- (Object) <strong>dest_prerelease_specs_index</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Prerelease specs index install location.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#dest_specs_index-instance_method" title="#dest_specs_index (instance method)">- (Object) <strong>dest_specs_index</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Specs index install location.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#directory-instance_method" title="#directory (instance method)">- (Object) <strong>directory</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Index build directory.
</p>
</div></span>
  
</li>

    
  </ul>



  
  
  
  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#abbreviate-instance_method" title="#abbreviate (instance method)">- (Object) <strong>abbreviate</strong>(spec) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Abbreviate the spec for downloading.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_indicies-instance_method" title="#build_indicies (instance method)">- (Object) <strong>build_indicies</strong>(index) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Build various indicies.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_legacy_indicies-instance_method" title="#build_legacy_indicies (instance method)">- (Object) <strong>build_legacy_indicies</strong>(index) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Builds indicies for RubyGems older than 1.2.x.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_marshal_gemspecs-instance_method" title="#build_marshal_gemspecs (instance method)">- (Object) <strong>build_marshal_gemspecs</strong>(index) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Builds Marshal quick index gemspecs.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_modern_index-instance_method" title="#build_modern_index (instance method)">- (Object) <strong>build_modern_index</strong>(index, file, name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Build a single index for RubyGems 1.2 and newer.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_modern_indicies-instance_method" title="#build_modern_indicies (instance method)">- (Object) <strong>build_modern_indicies</strong>(index) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Builds indicies for RubyGems 1.2 and newer.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_rss-instance_method" title="#build_rss (instance method)">- (Object) <strong>build_rss</strong>(index) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Builds an RSS feed for past two days gem releases according to the
gem&#8217;s date.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collect_specs-instance_method" title="#collect_specs (instance method)">- (Object) <strong>collect_specs</strong>(gems = gem_file_list) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Collect specifications from .gem files from the gem directory.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compact_specs-instance_method" title="#compact_specs (instance method)">- (Object) <strong>compact_specs</strong>(specs) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Compacts Marshal output for the specs index data source by using identical
objects as much as possible.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compress-instance_method" title="#compress (instance method)">- (Object) <strong>compress</strong>(filename, extension) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Compress <tt>filename</tt> with <tt>extension</tt>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compress_indicies-instance_method" title="#compress_indicies (instance method)">- (Object) <strong>compress_indicies</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Compresses indicies on disk &#8212; All future files should be compressed
using gzip, not deflate.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#gem_file_list-instance_method" title="#gem_file_list (instance method)">- (Object) <strong>gem_file_list</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
List of gem file names to index.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_index-instance_method" title="#generate_index (instance method)">- (Object) <strong>generate_index</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Builds and installs indicies.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#gzip-instance_method" title="#gzip (instance method)">- (Object) <strong>gzip</strong>(filename) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Zlib::GzipWriter wrapper that gzips <tt>filename</tt> on disk.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Indexer) <strong>initialize</strong>(directory, options = {}) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Create an indexer that will index the gems in <tt>directory</tt>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#install_indicies-instance_method" title="#install_indicies (instance method)">- (Object) <strong>install_indicies</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Install generated indicies into the destination directory.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#make_temp_directories-instance_method" title="#make_temp_directories (instance method)">- (Object) <strong>make_temp_directories</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Make directories for index generation.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#paranoid-instance_method" title="#paranoid (instance method)">- (Object) <strong>paranoid</strong>(path, extension) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Ensure <tt>path</tt> and path with <tt>extension</tt> are identical.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sanitize-instance_method" title="#sanitize (instance method)">- (Object) <strong>sanitize</strong>(spec) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Sanitize the descriptive fields in the spec.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sanitize_string-instance_method" title="#sanitize_string (instance method)">- (Object) <strong>sanitize_string</strong>(string) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Sanitize a single string.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_index-instance_method" title="#update_index (instance method)">- (Object) <strong>update_index</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Perform an in-place update of the repository from newly added gems.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_specs_index-instance_method" title="#update_specs_index (instance method)">- (Object) <strong>update_specs_index</strong>(index, source, dest) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Combines specs in <tt>index</tt> and <tt>source</tt> then writes out a new
copy to <tt>dest</tt>.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="UserInteraction.html" title="Gem::UserInteraction (module)">UserInteraction</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="UserInteraction.html#methname-instance_method" title="Gem::UserInteraction#methname (method)">#methname</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="DefaultUserInteraction.html" title="Gem::DefaultUserInteraction (module)">DefaultUserInteraction</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="DefaultUserInteraction.html#ui-class_method" title="Gem::DefaultUserInteraction.ui (method)">ui</a></span>, <span class='object_link'><a href="DefaultUserInteraction.html#ui-instance_method" title="Gem::DefaultUserInteraction#ui (method)">#ui</a></span>, <span class='object_link'><a href="DefaultUserInteraction.html#ui%3D-instance_method" title="Gem::DefaultUserInteraction#ui= (method)">#ui=</a></span>, <span class='object_link'><a href="DefaultUserInteraction.html#ui%3D-class_method" title="Gem::DefaultUserInteraction.ui= (method)">ui=</a></span>, <span class='object_link'><a href="DefaultUserInteraction.html#use_ui-class_method" title="Gem::DefaultUserInteraction.use_ui (method)">use_ui</a></span>, <span class='object_link'><a href="DefaultUserInteraction.html#use_ui-instance_method" title="Gem::DefaultUserInteraction#use_ui (method)">#use_ui</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Gem::Indexer (class)">Indexer</a></span></tt>) <strong>initialize</strong>(directory, options = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Create an indexer that will index the gems in <tt>directory</tt>.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 59</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id directory'>directory</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>Builder</span><span class='op'>::</span><span class='const'>XChar</span><span class='rparen'>)</span> <span class='kw'>then</span>
    <span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Gem::Indexer requires that the XML Builder library be installed:</span><span class='tstring_end'>&quot;</span></span> \
         <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\tgem install builder</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:build_legacy</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:build_modern</span> <span class='op'>=&gt;</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id merge'>merge</span> <span class='id options'>options</span>

  <span class='ivar'>@build_legacy</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:build_legacy</span><span class='rbracket'>]</span>
  <span class='ivar'>@build_modern</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:build_modern</span><span class='rbracket'>]</span>

  <span class='ivar'>@rss_title</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:rss_title</span><span class='rbracket'>]</span>
  <span class='ivar'>@rss_host</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:rss_host</span><span class='rbracket'>]</span>
  <span class='ivar'>@rss_gems_host</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:rss_gems_host</span><span class='rbracket'>]</span>

  <span class='ivar'>@dest_directory</span> <span class='op'>=</span> <span class='id directory'>directory</span>
  <span class='ivar'>@directory</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id tmpdir'>tmpdir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gem_generate_index_</span><span class='embexpr_beg'>#{</span><span class='gvar'>$$</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id marshal_name'>marshal_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Marshal.</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='period'>.</span><span class='id marshal_version'>marshal_version</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='ivar'>@master_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>yaml</span><span class='tstring_end'>'</span></span>
  <span class='ivar'>@marshal_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='id marshal_name'>marshal_name</span>

  <span class='ivar'>@quick_dir</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>quick</span><span class='tstring_end'>'</span></span>

  <span class='ivar'>@quick_marshal_dir</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@quick_dir</span><span class='comma'>,</span> <span class='id marshal_name'>marshal_name</span>

  <span class='ivar'>@quick_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@quick_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>index</span><span class='tstring_end'>'</span></span>
  <span class='ivar'>@latest_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@quick_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>latest_index</span><span class='tstring_end'>'</span></span>

  <span class='ivar'>@specs_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>specs.</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='period'>.</span><span class='id marshal_version'>marshal_version</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@latest_specs_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@directory</span><span class='comma'>,</span>
                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>latest_specs.</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='period'>.</span><span class='id marshal_version'>marshal_version</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@prerelease_specs_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='ivar'>@directory</span><span class='comma'>,</span>
                                      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prerelease_specs.</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='period'>.</span><span class='id marshal_version'>marshal_version</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@dest_specs_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@dest_directory</span><span class='comma'>,</span>
                                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>specs.</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='period'>.</span><span class='id marshal_version'>marshal_version</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@dest_latest_specs_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@dest_directory</span><span class='comma'>,</span>
                                       <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>latest_specs.</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='period'>.</span><span class='id marshal_version'>marshal_version</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@dest_prerelease_specs_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@dest_directory</span><span class='comma'>,</span>
                                          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prerelease_specs.</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='period'>.</span><span class='id marshal_version'>marshal_version</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='ivar'>@rss_index</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>index.rss</span><span class='tstring_end'>'</span></span>

  <span class='ivar'>@files</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="build_legacy=-instance_method"></span>
      <span id="build_legacy-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="build_legacy-instance_method">
  
    - (<tt>Object</tt>) <strong>build_legacy</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Build indexes for RubyGems older than 1.2.0 when true
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 24</span>

<span class='kw'>def</span> <span class='id build_legacy'>build_legacy</span>
  <span class='ivar'>@build_legacy</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="build_modern=-instance_method"></span>
      <span id="build_modern-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="build_modern-instance_method">
  
    - (<tt>Object</tt>) <strong>build_modern</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Build indexes for RubyGems 1.2.0 and newer when true
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 29</span>

<span class='kw'>def</span> <span class='id build_modern'>build_modern</span>
  <span class='ivar'>@build_modern</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="dest_directory-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="dest_directory-instance_method">
  
    - (<tt>Object</tt>) <strong>dest_directory</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Index install location
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 34</span>

<span class='kw'>def</span> <span class='id dest_directory'>dest_directory</span>
  <span class='ivar'>@dest_directory</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="dest_latest_specs_index-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="dest_latest_specs_index-instance_method">
  
    - (<tt>Object</tt>) <strong>dest_latest_specs_index</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Latest specs index install location
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 44</span>

<span class='kw'>def</span> <span class='id dest_latest_specs_index'>dest_latest_specs_index</span>
  <span class='ivar'>@dest_latest_specs_index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="dest_prerelease_specs_index-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="dest_prerelease_specs_index-instance_method">
  
    - (<tt>Object</tt>) <strong>dest_prerelease_specs_index</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Prerelease specs index install location
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 49</span>

<span class='kw'>def</span> <span class='id dest_prerelease_specs_index'>dest_prerelease_specs_index</span>
  <span class='ivar'>@dest_prerelease_specs_index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="dest_specs_index-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="dest_specs_index-instance_method">
  
    - (<tt>Object</tt>) <strong>dest_specs_index</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Specs index install location
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 39</span>

<span class='kw'>def</span> <span class='id dest_specs_index'>dest_specs_index</span>
  <span class='ivar'>@dest_specs_index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="directory-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="directory-instance_method">
  
    - (<tt>Object</tt>) <strong>directory</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Index build directory
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 54</span>

<span class='kw'>def</span> <span class='id directory'>directory</span>
  <span class='ivar'>@directory</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="abbreviate-instance_method">
  
    - (<tt>Object</tt>) <strong>abbreviate</strong>(spec) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Abbreviate the spec for downloading.  Abbreviated specs are only used for
searching, downloading and related activities and do not need deployment
specific information (e.g. list of files).  So we abbreviate the spec,
making it much smaller for quicker downloads.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


113
114
115
116
117
118
119
120</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 113</span>

<span class='kw'>def</span> <span class='id abbreviate'>abbreviate</span><span class='lparen'>(</span><span class='id spec'>spec</span><span class='rparen'>)</span>
  <span class='id spec'>spec</span><span class='period'>.</span><span class='id files'>files</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id spec'>spec</span><span class='period'>.</span><span class='id test_files'>test_files</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id spec'>spec</span><span class='period'>.</span><span class='id rdoc_options'>rdoc_options</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id spec'>spec</span><span class='period'>.</span><span class='id extra_rdoc_files'>extra_rdoc_files</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id spec'>spec</span><span class='period'>.</span><span class='id cert_chain'>cert_chain</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id spec'>spec</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="build_indicies-instance_method">
  
    - (<tt>Object</tt>) <strong>build_indicies</strong>(index) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Build various indicies
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


125
126
127
128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 125</span>

<span class='kw'>def</span> <span class='id build_indicies'>build_indicies</span><span class='lparen'>(</span><span class='id index'>index</span><span class='rparen'>)</span>
  <span class='comment'># Marshal gemspecs are used by both modern and legacy RubyGems
</span>  <span class='id build_marshal_gemspecs'>build_marshal_gemspecs</span> <span class='id index'>index</span>
  <span class='id build_legacy_indicies'>build_legacy_indicies</span> <span class='id index'>index</span> <span class='kw'>if</span> <span class='ivar'>@build_legacy</span>
  <span class='id build_modern_indicies'>build_modern_indicies</span> <span class='id index'>index</span> <span class='kw'>if</span> <span class='ivar'>@build_modern</span>
  <span class='id build_rss'>build_rss</span> <span class='id index'>index</span>

  <span class='id compress_indicies'>compress_indicies</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="build_legacy_indicies-instance_method">
  
    - (<tt>Object</tt>) <strong>build_legacy_indicies</strong>(index) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Builds indicies for RubyGems older than 1.2.x
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 138</span>

<span class='kw'>def</span> <span class='id build_legacy_indicies'>build_legacy_indicies</span><span class='lparen'>(</span><span class='id index'>index</span><span class='rparen'>)</span>
  <span class='id progress'>progress</span> <span class='op'>=</span> <span class='id ui'>ui</span><span class='period'>.</span><span class='id progress_reporter'>progress_reporter</span> <span class='id index'>index</span><span class='period'>.</span><span class='id size'>size</span><span class='comma'>,</span>
                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Generating YAML quick index gemspecs for </span><span class='embexpr_beg'>#{</span><span class='id index'>index</span><span class='period'>.</span><span class='id size'>size</span><span class='rbrace'>}</span><span class='tstring_content'> gems</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Complete</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Generated YAML quick index gemspecs</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id index'>index</span><span class='period'>.</span><span class='id released_gems'>released_gems</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id original_name'>original_name</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='op'>|</span>
      <span class='id spec_file_name'>spec_file_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id original_name'>original_name</span><span class='rbrace'>}</span><span class='tstring_content'>.gemspec.rz</span><span class='tstring_end'>&quot;</span></span>
      <span class='id yaml_name'>yaml_name</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@quick_dir</span><span class='comma'>,</span> <span class='id spec_file_name'>spec_file_name</span>

      <span class='id yaml_zipped'>yaml_zipped</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id deflate'>deflate</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id to_yaml'>to_yaml</span>
      <span class='id open'>open</span> <span class='id yaml_name'>yaml_name</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>wb</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span> <span class='id io'>io</span><span class='period'>.</span><span class='id write'>write</span> <span class='id yaml_zipped'>yaml_zipped</span> <span class='kw'>end</span>

      <span class='id progress'>progress</span><span class='period'>.</span><span class='id updated'>updated</span> <span class='id original_name'>original_name</span>
    <span class='kw'>end</span>

    <span class='id progress'>progress</span><span class='period'>.</span><span class='id done'>done</span>
  <span class='kw'>end</span>

  <span class='id say'>say</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Generating quick index</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Generated quick index</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id open'>open</span> <span class='ivar'>@quick_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>wb</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span>
      <span class='id io'>io</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='id index'>index</span><span class='period'>.</span><span class='id sort'>sort</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id _'>_</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='op'>|</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id original_name'>original_name</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id say'>say</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Generating latest index</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Generated latest index</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id open'>open</span> <span class='ivar'>@latest_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>wb</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span>
      <span class='id io'>io</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='id index'>index</span><span class='period'>.</span><span class='id latest_specs'>latest_specs</span><span class='period'>.</span><span class='id sort'>sort</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id spec'>spec</span><span class='op'>|</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id original_name'>original_name</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Don't need prerelease legacy index
</span>
  <span class='id say'>say</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Generating Marshal master index</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Generated Marshal master index</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id open'>open</span> <span class='ivar'>@marshal_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>wb</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span>
      <span class='id io'>io</span><span class='period'>.</span><span class='id write'>write</span> <span class='id index'>index</span><span class='period'>.</span><span class='id dump'>dump</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id progress'>progress</span> <span class='op'>=</span> <span class='id ui'>ui</span><span class='period'>.</span><span class='id progress_reporter'>progress_reporter</span> <span class='id index'>index</span><span class='period'>.</span><span class='id size'>size</span><span class='comma'>,</span>
                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Generating YAML master index for </span><span class='embexpr_beg'>#{</span><span class='id index'>index</span><span class='period'>.</span><span class='id size'>size</span><span class='rbrace'>}</span><span class='tstring_content'> gems (this may take a while)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Complete</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Generated YAML master index</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id open'>open</span> <span class='ivar'>@master_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>wb</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span>
      <span class='id io'>io</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--- !ruby/object:</span><span class='embexpr_beg'>#{</span><span class='id index'>index</span><span class='period'>.</span><span class='id class'>class</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id io'>io</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gems:</span><span class='tstring_end'>&quot;</span></span>

      <span class='id gems'>gems</span> <span class='op'>=</span> <span class='id index'>index</span><span class='period'>.</span><span class='id sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id gemspec'>gemspec</span><span class='op'>|</span> <span class='id gemspec'>gemspec</span><span class='period'>.</span><span class='id sort_obj'>sort_obj</span> <span class='rbrace'>}</span>
      <span class='id gems'>gems</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id original_name'>original_name</span><span class='comma'>,</span> <span class='id gemspec'>gemspec</span><span class='op'>|</span>
        <span class='id yaml'>yaml</span> <span class='op'>=</span> <span class='id gemspec'>gemspec</span><span class='period'>.</span><span class='id to_yaml'>to_yaml</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>    </span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
        <span class='id yaml'>yaml</span> <span class='op'>=</span> <span class='id yaml'>yaml</span><span class='period'>.</span><span class='id sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A    ---</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='comment'># there's a needed extra ' ' here
</span>        <span class='id io'>io</span><span class='period'>.</span><span class='id print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id original_name'>original_name</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span>
        <span class='id io'>io</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='id yaml'>yaml</span>

        <span class='id progress'>progress</span><span class='period'>.</span><span class='id updated'>updated</span> <span class='id original_name'>original_name</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id progress'>progress</span><span class='period'>.</span><span class='id done'>done</span>
  <span class='kw'>end</span>

  <span class='ivar'>@files</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@quick_dir</span>
  <span class='ivar'>@files</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@master_index</span>
  <span class='ivar'>@files</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@master_index</span><span class='rbrace'>}</span><span class='tstring_content'>.Z</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@files</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@marshal_index</span>
  <span class='ivar'>@files</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@marshal_index</span><span class='rbrace'>}</span><span class='tstring_content'>.Z</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="build_marshal_gemspecs-instance_method">
  
    - (<tt>Object</tt>) <strong>build_marshal_gemspecs</strong>(index) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Builds Marshal quick index gemspecs.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 216</span>

<span class='kw'>def</span> <span class='id build_marshal_gemspecs'>build_marshal_gemspecs</span><span class='lparen'>(</span><span class='id index'>index</span><span class='rparen'>)</span>
  <span class='id progress'>progress</span> <span class='op'>=</span> <span class='id ui'>ui</span><span class='period'>.</span><span class='id progress_reporter'>progress_reporter</span> <span class='id index'>index</span><span class='period'>.</span><span class='id size'>size</span><span class='comma'>,</span>
                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Generating Marshal quick index gemspecs for </span><span class='embexpr_beg'>#{</span><span class='id index'>index</span><span class='period'>.</span><span class='id size'>size</span><span class='rbrace'>}</span><span class='tstring_content'> gems</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Complete</span><span class='tstring_end'>&quot;</span></span>

  <span class='id files'>files</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Generated Marshal quick index gemspecs</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id index'>index</span><span class='period'>.</span><span class='id gems'>gems</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id original_name'>original_name</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='op'>|</span>
      <span class='id spec_file_name'>spec_file_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id original_name'>original_name</span><span class='rbrace'>}</span><span class='tstring_content'>.gemspec.rz</span><span class='tstring_end'>&quot;</span></span>
      <span class='id marshal_name'>marshal_name</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@quick_marshal_dir</span><span class='comma'>,</span> <span class='id spec_file_name'>spec_file_name</span>

      <span class='id marshal_zipped'>marshal_zipped</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id deflate'>deflate</span> <span class='const'>Marshal</span><span class='period'>.</span><span class='id dump'>dump</span><span class='lparen'>(</span><span class='id spec'>spec</span><span class='rparen'>)</span>
      <span class='id open'>open</span> <span class='id marshal_name'>marshal_name</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>wb</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span> <span class='id io'>io</span><span class='period'>.</span><span class='id write'>write</span> <span class='id marshal_zipped'>marshal_zipped</span> <span class='kw'>end</span>

      <span class='id files'>files</span> <span class='op'>&lt;&lt;</span> <span class='id marshal_name'>marshal_name</span>

      <span class='id progress'>progress</span><span class='period'>.</span><span class='id updated'>updated</span> <span class='id original_name'>original_name</span>
    <span class='kw'>end</span>

    <span class='id progress'>progress</span><span class='period'>.</span><span class='id done'>done</span>
  <span class='kw'>end</span>

  <span class='ivar'>@files</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@quick_marshal_dir</span>

  <span class='id files'>files</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="build_modern_index-instance_method">
  
    - (<tt>Object</tt>) <strong>build_modern_index</strong>(index, file, name) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Build a single index for RubyGems 1.2 and newer
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 247</span>

<span class='kw'>def</span> <span class='id build_modern_index'>build_modern_index</span><span class='lparen'>(</span><span class='id index'>index</span><span class='comma'>,</span> <span class='id file'>file</span><span class='comma'>,</span> <span class='id name'>name</span><span class='rparen'>)</span>
  <span class='id say'>say</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Generating </span><span class='embexpr_beg'>#{</span><span class='id name'>name</span><span class='rbrace'>}</span><span class='tstring_content'> index</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Generated </span><span class='embexpr_beg'>#{</span><span class='id name'>name</span><span class='rbrace'>}</span><span class='tstring_content'> index</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id open'>open</span><span class='lparen'>(</span><span class='id file'>file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>wb</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span>
      <span class='id specs'>specs</span> <span class='op'>=</span> <span class='id index'>index</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id spec'>spec</span><span class='op'>|</span>
        <span class='comment'># We have to splat here because latest_specs is an array,
</span>        <span class='comment'># while the others are hashes. See the TODO in source_index.rb
</span>        <span class='id spec'>spec</span> <span class='op'>=</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id last'>last</span>
        <span class='id platform'>platform</span> <span class='op'>=</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id original_platform'>original_platform</span>

        <span class='comment'># win32-api-1.0.4-x86-mswin32-60
</span>        <span class='kw'>unless</span> <span class='const'>String</span> <span class='op'>===</span> <span class='id platform'>platform</span> <span class='kw'>then</span>
          <span class='id alert_warning'>alert_warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping invalid platform in gem: </span><span class='embexpr_beg'>#{</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id full_name'>full_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>next</span>
        <span class='kw'>end</span>

        <span class='id platform'>platform</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Platform</span><span class='op'>::</span><span class='const'>RUBY</span> <span class='kw'>if</span> <span class='id platform'>platform</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='kw'>or</span> <span class='id platform'>platform</span><span class='period'>.</span><span class='id empty?'>empty?</span>
        <span class='lbracket'>[</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id version'>version</span><span class='comma'>,</span> <span class='id platform'>platform</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id specs'>specs</span> <span class='op'>=</span> <span class='id compact_specs'>compact_specs</span><span class='lparen'>(</span><span class='id specs'>specs</span><span class='rparen'>)</span>
      <span class='const'>Marshal</span><span class='period'>.</span><span class='id dump'>dump</span><span class='lparen'>(</span><span class='id specs'>specs</span><span class='comma'>,</span> <span class='id io'>io</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="build_modern_indicies-instance_method">
  
    - (<tt>Object</tt>) <strong>build_modern_indicies</strong>(index) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Builds indicies for RubyGems 1.2 and newer. Handles full, latest,
prerelease
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 277</span>

<span class='kw'>def</span> <span class='id build_modern_indicies'>build_modern_indicies</span><span class='lparen'>(</span><span class='id index'>index</span><span class='rparen'>)</span>
  <span class='id build_modern_index'>build_modern_index</span><span class='lparen'>(</span><span class='id index'>index</span><span class='period'>.</span><span class='id released_specs'>released_specs</span><span class='period'>.</span><span class='id sort'>sort</span><span class='comma'>,</span> <span class='ivar'>@specs_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>specs</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id build_modern_index'>build_modern_index</span><span class='lparen'>(</span><span class='id index'>index</span><span class='period'>.</span><span class='id latest_specs'>latest_specs</span><span class='period'>.</span><span class='id sort'>sort</span><span class='comma'>,</span>
                     <span class='ivar'>@latest_specs_index</span><span class='comma'>,</span>
                     <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>latest specs</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id build_modern_index'>build_modern_index</span><span class='lparen'>(</span><span class='id index'>index</span><span class='period'>.</span><span class='id prerelease_specs'>prerelease_specs</span><span class='period'>.</span><span class='id sort'>sort</span><span class='comma'>,</span>
                     <span class='ivar'>@prerelease_specs_index</span><span class='comma'>,</span>
                     <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>prerelease specs</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>

  <span class='ivar'>@files</span> <span class='op'>+=</span> <span class='lbracket'>[</span><span class='ivar'>@specs_index</span><span class='comma'>,</span>
             <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@specs_index</span><span class='rbrace'>}</span><span class='tstring_content'>.gz</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
             <span class='ivar'>@latest_specs_index</span><span class='comma'>,</span>
             <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@latest_specs_index</span><span class='rbrace'>}</span><span class='tstring_content'>.gz</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
             <span class='ivar'>@prerelease_specs_index</span><span class='comma'>,</span>
             <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@prerelease_specs_index</span><span class='rbrace'>}</span><span class='tstring_content'>.gz</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="build_rss-instance_method">
  
    - (<tt>Object</tt>) <strong>build_rss</strong>(index) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Builds an RSS feed for past two days gem releases according to the
gem&#8217;s date.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 298</span>

<span class='kw'>def</span> <span class='id build_rss'>build_rss</span><span class='lparen'>(</span><span class='id index'>index</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@rss_host</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='kw'>or</span> <span class='ivar'>@rss_gems_host</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='kw'>then</span>
    <span class='kw'>if</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id configuration'>configuration</span><span class='period'>.</span><span class='id really_verbose'>really_verbose</span> <span class='kw'>then</span>
      <span class='id alert_warning'>alert_warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no --rss-host or --rss-gems-host, RSS generation disabled</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cgi</span><span class='tstring_end'>'</span></span>
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rubygems/text</span><span class='tstring_end'>'</span></span>

  <span class='id extend'>extend</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Text</span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Generated rss</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id open'>open</span> <span class='ivar'>@rss_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>wb</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span>
      <span class='id rss_host'>rss_host</span> <span class='op'>=</span> <span class='const'>CGI</span><span class='period'>.</span><span class='id escapeHTML'>escapeHTML</span> <span class='ivar'>@rss_host</span>
      <span class='id rss_title'>rss_title</span> <span class='op'>=</span> <span class='const'>CGI</span><span class='period'>.</span><span class='id escapeHTML'>escapeHTML</span><span class='lparen'>(</span><span class='ivar'>@rss_title</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>gems</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>

      <span class='id io'>io</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='heredoc_beg'>&lt;&lt;-HEADER</span><span class='tstring_content'>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;rss version=&quot;2.0&quot;&gt;
&lt;channel&gt;
</span><span class='tstring_content'>  &lt;title&gt;</span><span class='embexpr_beg'>#{</span><span class='id rss_title'>rss_title</span><span class='rbrace'>}</span><span class='tstring_content'>&lt;/title&gt;
</span><span class='tstring_content'>  &lt;link&gt;http://</span><span class='embexpr_beg'>#{</span><span class='id rss_host'>rss_host</span><span class='rbrace'>}</span><span class='tstring_content'>&lt;/link&gt;
</span><span class='tstring_content'>  &lt;description&gt;Recently released gems from http://</span><span class='embexpr_beg'>#{</span><span class='id rss_host'>rss_host</span><span class='rbrace'>}</span><span class='tstring_content'>&lt;/description&gt;
</span><span class='tstring_content'>  &lt;generator&gt;RubyGems v</span><span class='embexpr_beg'>#{</span><span class='const'>Gem</span><span class='op'>::</span><span class='const'>VERSION</span><span class='rbrace'>}</span>
<span class='tstring_content'>&lt;/generator&gt;
  &lt;docs&gt;http://cyber.law.harvard.edu/rss/rss.html&lt;/docs&gt;
</span><span class='heredoc_end'>      HEADER
</span>
      <span class='id today'>today</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Specification</span><span class='op'>::</span><span class='const'>TODAY</span>
      <span class='id yesterday'>yesterday</span> <span class='op'>=</span> <span class='id today'>today</span> <span class='op'>-</span> <span class='int'>86400</span>

      <span class='id index'>index</span> <span class='op'>=</span> <span class='id index'>index</span><span class='period'>.</span><span class='id select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id _'>_</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='op'>|</span>
        <span class='id spec_date'>spec_date</span> <span class='op'>=</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id date'>date</span>

        <span class='kw'>case</span> <span class='id spec_date'>spec_date</span>
        <span class='kw'>when</span> <span class='const'>Date</span>
          <span class='const'>Time</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id spec_date'>spec_date</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='id yesterday'>yesterday</span>
        <span class='kw'>when</span> <span class='const'>Time</span>
          <span class='id spec_date'>spec_date</span> <span class='op'>&gt;=</span> <span class='id yesterday'>yesterday</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id index'>index</span> <span class='op'>=</span> <span class='id index'>index</span><span class='period'>.</span><span class='id select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id _'>_</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='op'>|</span>
        <span class='id spec_date'>spec_date</span> <span class='op'>=</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id date'>date</span>

        <span class='kw'>case</span> <span class='id spec_date'>spec_date</span>
        <span class='kw'>when</span> <span class='const'>Date</span>
          <span class='const'>Time</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id spec_date'>spec_date</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rparen'>)</span> <span class='op'>&lt;=</span> <span class='id today'>today</span>
        <span class='kw'>when</span> <span class='const'>Time</span>
          <span class='id spec_date'>spec_date</span> <span class='op'>&lt;=</span> <span class='id today'>today</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id index'>index</span><span class='period'>.</span><span class='id sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id _'>_</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='op'>-</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id date'>date</span><span class='period'>.</span><span class='id to_i'>to_i</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id _'>_</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='op'>|</span>
        <span class='id gem_path'>gem_path</span> <span class='op'>=</span> <span class='const'>CGI</span><span class='period'>.</span><span class='id escapeHTML'>escapeHTML</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://</span><span class='embexpr_beg'>#{</span><span class='ivar'>@rss_gems_host</span><span class='rbrace'>}</span><span class='tstring_content'>/gems/</span><span class='embexpr_beg'>#{</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id file_name'>file_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='id size'>size</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id stat'>stat</span><span class='lparen'>(</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id loaded_from'>loaded_from</span><span class='rparen'>)</span><span class='period'>.</span><span class='id size'>size</span> <span class='kw'>rescue</span> <span class='kw'>next</span>

        <span class='id description'>description</span> <span class='op'>=</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id description'>description</span> <span class='op'>||</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id summary'>summary</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
        <span class='id authors'>authors</span> <span class='op'>=</span> <span class='const'>Array</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id authors'>authors</span>
        <span class='id emails'>emails</span> <span class='op'>=</span> <span class='const'>Array</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id email'>email</span>
        <span class='id authors'>authors</span> <span class='op'>=</span> <span class='id emails'>emails</span><span class='period'>.</span><span class='id zip'>zip</span><span class='lparen'>(</span><span class='id authors'>authors</span><span class='rparen'>)</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id email'>email</span><span class='comma'>,</span> <span class='id author'>author</span><span class='op'>|</span>
          <span class='id email'>email</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id author'>author</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id author'>author</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id author'>author</span><span class='period'>.</span><span class='id empty?'>empty?</span>
        <span class='kw'>end</span><span class='period'>.</span><span class='id join'>join</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>, </span><span class='tstring_end'>'</span></span>

        <span class='id description'>description</span> <span class='op'>=</span> <span class='id description'>description</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\n\n+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id chunk'>chunk</span><span class='op'>|</span>
          <span class='id format_text'>format_text</span> <span class='id chunk'>chunk</span><span class='comma'>,</span> <span class='int'>78</span>
        <span class='kw'>end</span>

        <span class='id description'>description</span> <span class='op'>=</span> <span class='id description'>description</span><span class='period'>.</span><span class='id join'>join</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span>

        <span class='id item'>item</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>

        <span class='id item'>item</span> <span class='op'>&lt;&lt;</span> <span class='heredoc_beg'>&lt;&lt;-ITEM</span><span class='tstring_content'>  &lt;item&gt;
</span><span class='tstring_content'>    &lt;title&gt;</span><span class='embexpr_beg'>#{</span><span class='const'>CGI</span><span class='period'>.</span><span class='id escapeHTML'>escapeHTML</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id full_name'>full_name</span><span class='rbrace'>}</span><span class='tstring_content'>&lt;/title&gt;
    &lt;description&gt;
</span><span class='tstring_content'>&amp;lt;pre&amp;gt;</span><span class='embexpr_beg'>#{</span><span class='const'>CGI</span><span class='period'>.</span><span class='id escapeHTML'>escapeHTML</span> <span class='id description'>description</span><span class='period'>.</span><span class='id chomp'>chomp</span><span class='rbrace'>}</span><span class='tstring_content'>&amp;lt;/pre&amp;gt;
    &lt;/description&gt;
</span><span class='tstring_content'>    &lt;author&gt;</span><span class='embexpr_beg'>#{</span><span class='const'>CGI</span><span class='period'>.</span><span class='id escapeHTML'>escapeHTML</span> <span class='id authors'>authors</span><span class='rbrace'>}</span><span class='tstring_content'>&lt;/author&gt;
</span><span class='tstring_content'>    &lt;guid&gt;</span><span class='embexpr_beg'>#{</span><span class='const'>CGI</span><span class='period'>.</span><span class='id escapeHTML'>escapeHTML</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id full_name'>full_name</span><span class='rbrace'>}</span><span class='tstring_content'>&lt;/guid&gt;
</span><span class='tstring_content'>    &lt;enclosure url=\&quot;</span><span class='embexpr_beg'>#{</span><span class='id gem_path'>gem_path</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;
</span><span class='tstring_content'>               length=\&quot;</span><span class='embexpr_beg'>#{</span><span class='id size'>size</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; type=\&quot;application/octet-stream\&quot; /&gt;
</span><span class='tstring_content'>    &lt;pubDate&gt;</span><span class='embexpr_beg'>#{</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id date'>date</span><span class='period'>.</span><span class='id rfc2822'>rfc2822</span><span class='rbrace'>}</span>
<span class='tstring_content'>&lt;/pubDate&gt;
</span><span class='heredoc_end'>        ITEM
</span>
        <span class='id item'>item</span> <span class='op'>&lt;&lt;</span> <span class='heredoc_beg'>&lt;&lt;-ITEM</span><span class='tstring_content'>    &lt;link&gt;</span><span class='embexpr_beg'>#{</span><span class='const'>CGI</span><span class='period'>.</span><span class='id escapeHTML'>escapeHTML</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id homepage'>homepage</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id homepage'>homepage</span>
<span class='tstring_content'>&lt;/link&gt;
</span><span class='heredoc_end'>        ITEM
</span>
        <span class='id item'>item</span> <span class='op'>&lt;&lt;</span> <span class='heredoc_beg'>&lt;&lt;-ITEM</span>
<span class='tstring_content'>  &lt;/item&gt;
</span><span class='heredoc_end'>        ITEM
</span>
        <span class='id io'>io</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='id item'>item</span>
      <span class='kw'>end</span>

      <span class='id io'>io</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='heredoc_beg'>&lt;&lt;-FOOTER</span>
<span class='tstring_content'>&lt;/channel&gt;
&lt;/rss&gt;
</span><span class='heredoc_end'>      FOOTER
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@files</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@rss_index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="collect_specs-instance_method">
  
    - (<tt>Object</tt>) <strong>collect_specs</strong>(gems = gem_file_list) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Collect specifications from .gem files from the gem directory.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 408</span>

<span class='kw'>def</span> <span class='id collect_specs'>collect_specs</span><span class='lparen'>(</span><span class='id gems'>gems</span> <span class='op'>=</span> <span class='id gem_file_list'>gem_file_list</span><span class='rparen'>)</span>
  <span class='id index'>index</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>SourceIndex</span><span class='period'>.</span><span class='id new'>new</span>

  <span class='id progress'>progress</span> <span class='op'>=</span> <span class='id ui'>ui</span><span class='period'>.</span><span class='id progress_reporter'>progress_reporter</span> <span class='id gems'>gems</span><span class='period'>.</span><span class='id size'>size</span><span class='comma'>,</span>
                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Loading </span><span class='embexpr_beg'>#{</span><span class='id gems'>gems</span><span class='period'>.</span><span class='id size'>size</span><span class='rbrace'>}</span><span class='tstring_content'> gems from </span><span class='embexpr_beg'>#{</span><span class='ivar'>@dest_directory</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Loaded all gems</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>loaded</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id gems'>gems</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id gemfile'>gemfile</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id size'>size</span><span class='lparen'>(</span><span class='id gemfile'>gemfile</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>0</span> <span class='kw'>then</span>
        <span class='id alert_warning'>alert_warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping zero-length gem: </span><span class='embexpr_beg'>#{</span><span class='id gemfile'>gemfile</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='kw'>begin</span>
        <span class='id spec'>spec</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Format</span><span class='period'>.</span><span class='id from_file_by_path'>from_file_by_path</span><span class='lparen'>(</span><span class='id gemfile'>gemfile</span><span class='rparen'>)</span><span class='period'>.</span><span class='id spec'>spec</span>
        <span class='id spec'>spec</span><span class='period'>.</span><span class='id loaded_from'>loaded_from</span> <span class='op'>=</span> <span class='id gemfile'>gemfile</span>

        <span class='kw'>unless</span> <span class='id gemfile'>gemfile</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\/</span><span class='embexpr_beg'>#{</span><span class='const'>Regexp</span><span class='period'>.</span><span class='id escape'>escape</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id original_name'>original_name</span><span class='rbrace'>}</span><span class='tstring_content'>.*\.gem\z</span><span class='regexp_end'>/i</span></span> <span class='kw'>then</span>
          <span class='id expected_name'>expected_name</span> <span class='op'>=</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id full_name'>full_name</span>
          <span class='id expected_name'>expected_name</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id original_name'>original_name</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span>
            <span class='id spec'>spec</span><span class='period'>.</span><span class='id original_name'>original_name</span> <span class='op'>!=</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id full_name'>full_name</span>
          <span class='id alert_warning'>alert_warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping misnamed gem: </span><span class='embexpr_beg'>#{</span><span class='id gemfile'>gemfile</span><span class='rbrace'>}</span><span class='tstring_content'> should be named </span><span class='embexpr_beg'>#{</span><span class='id expected_name'>expected_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>next</span>
        <span class='kw'>end</span>

        <span class='id abbreviate'>abbreviate</span> <span class='id spec'>spec</span>
        <span class='id sanitize'>sanitize</span> <span class='id spec'>spec</span>

        <span class='id index'>index</span><span class='period'>.</span><span class='id add_spec'>add_spec</span> <span class='id spec'>spec</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id original_name'>original_name</span>

        <span class='id progress'>progress</span><span class='period'>.</span><span class='id updated'>updated</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id original_name'>original_name</span>

      <span class='kw'>rescue</span> <span class='const'>SignalException</span> <span class='op'>=&gt;</span> <span class='id e'>e</span>
        <span class='id alert_error'>alert_error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received signal, exiting</span><span class='tstring_end'>&quot;</span></span>
        <span class='id raise'>raise</span>
      <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id e'>e</span>
        <span class='id alert_error'>alert_error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to process </span><span class='embexpr_beg'>#{</span><span class='id gemfile'>gemfile</span><span class='rbrace'>}</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id e'>e</span><span class='period'>.</span><span class='id message'>message</span><span class='rbrace'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id e'>e</span><span class='period'>.</span><span class='id class'>class</span><span class='rbrace'>}</span><span class='tstring_content'>)\n\t</span><span class='embexpr_beg'>#{</span><span class='id e'>e</span><span class='period'>.</span><span class='id backtrace'>backtrace</span><span class='period'>.</span><span class='id join'>join</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id progress'>progress</span><span class='period'>.</span><span class='id done'>done</span>
  <span class='kw'>end</span>

  <span class='id index'>index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="compact_specs-instance_method">
  
    - (<tt>Object</tt>) <strong>compact_specs</strong>(specs) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Compacts Marshal output for the specs index data source by using identical
objects as much as possible.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


490
491
492
493
494
495
496
497
498
499
500
501
502</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 490</span>

<span class='kw'>def</span> <span class='id compact_specs'>compact_specs</span><span class='lparen'>(</span><span class='id specs'>specs</span><span class='rparen'>)</span>
  <span class='id names'>names</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id versions'>versions</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id platforms'>platforms</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='id specs'>specs</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id version'>version</span><span class='comma'>,</span> <span class='id platform'>platform</span><span class='rparen'>)</span><span class='op'>|</span>
    <span class='id names'>names</span><span class='lbracket'>[</span><span class='id name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id name'>name</span> <span class='kw'>unless</span> <span class='id names'>names</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='id name'>name</span>
    <span class='id versions'>versions</span><span class='lbracket'>[</span><span class='id version'>version</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id version'>version</span> <span class='kw'>unless</span> <span class='id versions'>versions</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='id version'>version</span>
    <span class='id platforms'>platforms</span><span class='lbracket'>[</span><span class='id platform'>platform</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id platform'>platform</span> <span class='kw'>unless</span> <span class='id platforms'>platforms</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='id platform'>platform</span>

    <span class='lbracket'>[</span><span class='id names'>names</span><span class='lbracket'>[</span><span class='id name'>name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id versions'>versions</span><span class='lbracket'>[</span><span class='id version'>version</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id platforms'>platforms</span><span class='lbracket'>[</span><span class='id platform'>platform</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="compress-instance_method">
  
    - (<tt>Object</tt>) <strong>compress</strong>(filename, extension) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Compress <tt>filename</tt> with <tt>extension</tt>.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


507
508
509
510
511
512
513
514
515</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 507</span>

<span class='kw'>def</span> <span class='id compress'>compress</span><span class='lparen'>(</span><span class='id filename'>filename</span><span class='comma'>,</span> <span class='id extension'>extension</span><span class='rparen'>)</span>
  <span class='id data'>data</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id read_binary'>read_binary</span> <span class='id filename'>filename</span>

  <span class='id zipped'>zipped</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id deflate'>deflate</span> <span class='id data'>data</span>

  <span class='id open'>open</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id filename'>filename</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id extension'>extension</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>wb</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span>
    <span class='id io'>io</span><span class='period'>.</span><span class='id write'>write</span> <span class='id zipped'>zipped</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="compress_indicies-instance_method">
  
    - (<tt>Object</tt>) <strong>compress_indicies</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Compresses indicies on disk &#8212; All future files should be compressed
using gzip, not deflate
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 460</span>

<span class='kw'>def</span> <span class='id compress_indicies'>compress_indicies</span>
  <span class='id say'>say</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Compressing indicies</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Compressed indicies</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='ivar'>@build_legacy</span> <span class='kw'>then</span>
      <span class='id compress'>compress</span> <span class='ivar'>@quick_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rz</span><span class='tstring_end'>'</span></span>
      <span class='id paranoid'>paranoid</span> <span class='ivar'>@quick_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rz</span><span class='tstring_end'>'</span></span>

      <span class='id compress'>compress</span> <span class='ivar'>@latest_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rz</span><span class='tstring_end'>'</span></span>
      <span class='id paranoid'>paranoid</span> <span class='ivar'>@latest_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rz</span><span class='tstring_end'>'</span></span>

      <span class='id compress'>compress</span> <span class='ivar'>@marshal_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Z</span><span class='tstring_end'>'</span></span>
      <span class='id paranoid'>paranoid</span> <span class='ivar'>@marshal_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Z</span><span class='tstring_end'>'</span></span>

      <span class='id compress'>compress</span> <span class='ivar'>@master_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Z</span><span class='tstring_end'>'</span></span>
      <span class='id paranoid'>paranoid</span> <span class='ivar'>@master_index</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Z</span><span class='tstring_end'>'</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='ivar'>@build_modern</span> <span class='kw'>then</span>
      <span class='id gzip'>gzip</span> <span class='ivar'>@specs_index</span>
      <span class='id gzip'>gzip</span> <span class='ivar'>@latest_specs_index</span>
      <span class='id gzip'>gzip</span> <span class='ivar'>@prerelease_specs_index</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="gem_file_list-instance_method">
  
    - (<tt>Object</tt>) <strong>gem_file_list</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
List of gem file names to index.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


520
521
522</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 520</span>

<span class='kw'>def</span> <span class='id gem_file_list'>gem_file_list</span>
  <span class='const'>Dir</span><span class='period'>.</span><span class='id glob'>glob</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='ivar'>@dest_directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gems</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*.gem</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="generate_index-instance_method">
  
    - (<tt>Object</tt>) <strong>generate_index</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Builds and installs indicies.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


527
528
529
530
531
532
533
534
535</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 527</span>

<span class='kw'>def</span> <span class='id generate_index'>generate_index</span>
  <span class='id make_temp_directories'>make_temp_directories</span>
  <span class='id index'>index</span> <span class='op'>=</span> <span class='id collect_specs'>collect_specs</span>
  <span class='id build_indicies'>build_indicies</span> <span class='id index'>index</span>
  <span class='id install_indicies'>install_indicies</span>
<span class='kw'>rescue</span> <span class='const'>SignalException</span>
<span class='kw'>ensure</span>
  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id rm_rf'>rm_rf</span> <span class='ivar'>@directory</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="gzip-instance_method">
  
    - (<tt>Object</tt>) <strong>gzip</strong>(filename) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Zlib::GzipWriter wrapper that gzips <tt>filename</tt> on disk.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


540
541
542
543
544</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 540</span>

<span class='kw'>def</span> <span class='id gzip'>gzip</span><span class='lparen'>(</span><span class='id filename'>filename</span><span class='rparen'>)</span>
  <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>GzipWriter</span><span class='period'>.</span><span class='id open'>open</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id filename'>filename</span><span class='rbrace'>}</span><span class='tstring_content'>.gz</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span>
    <span class='id io'>io</span><span class='period'>.</span><span class='id write'>write</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id read_binary'>read_binary</span><span class='lparen'>(</span><span class='id filename'>filename</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="install_indicies-instance_method">
  
    - (<tt>Object</tt>) <strong>install_indicies</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Install generated indicies into the destination directory.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 549</span>

<span class='kw'>def</span> <span class='id install_indicies'>install_indicies</span>
  <span class='id verbose'>verbose</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id configuration'>configuration</span><span class='period'>.</span><span class='id really_verbose'>really_verbose</span>

  <span class='id say'>say</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Moving index into production dir </span><span class='embexpr_beg'>#{</span><span class='ivar'>@dest_directory</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id verbose'>verbose</span>

  <span class='id files'>files</span> <span class='op'>=</span> <span class='ivar'>@files</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='id files'>files</span><span class='period'>.</span><span class='id delete'>delete</span> <span class='ivar'>@quick_marshal_dir</span> <span class='kw'>if</span> <span class='id files'>files</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='ivar'>@quick_dir</span>

  <span class='kw'>if</span> <span class='id files'>files</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='ivar'>@quick_marshal_dir</span> <span class='kw'>and</span>
     <span class='kw'>not</span> <span class='id files'>files</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='ivar'>@quick_dir</span> <span class='kw'>then</span>
    <span class='id files'>files</span><span class='period'>.</span><span class='id delete'>delete</span> <span class='ivar'>@quick_marshal_dir</span>
    <span class='id quick_marshal_dir'>quick_marshal_dir</span> <span class='op'>=</span> <span class='ivar'>@quick_marshal_dir</span><span class='period'>.</span><span class='id sub'>sub</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>

    <span class='id dst_name'>dst_name</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@dest_directory</span><span class='comma'>,</span> <span class='id quick_marshal_dir'>quick_marshal_dir</span>

    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id mkdir_p'>mkdir_p</span> <span class='const'>File</span><span class='period'>.</span><span class='id dirname'>dirname</span><span class='lparen'>(</span><span class='id dst_name'>dst_name</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:verbose</span> <span class='op'>=&gt;</span> <span class='id verbose'>verbose</span>
    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id rm_rf'>rm_rf</span> <span class='id dst_name'>dst_name</span><span class='comma'>,</span> <span class='symbol'>:verbose</span> <span class='op'>=&gt;</span> <span class='id verbose'>verbose</span>
    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id mv'>mv</span> <span class='ivar'>@quick_marshal_dir</span><span class='comma'>,</span> <span class='id dst_name'>dst_name</span><span class='comma'>,</span> <span class='symbol'>:verbose</span> <span class='op'>=&gt;</span> <span class='id verbose'>verbose</span><span class='comma'>,</span>
                 <span class='symbol'>:force</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='id files'>files</span> <span class='op'>=</span> <span class='id files'>files</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id path'>path</span><span class='op'>|</span>
    <span class='id path'>path</span><span class='period'>.</span><span class='id sub'>sub</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='id files'>files</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id file'>file</span><span class='op'>|</span>
    <span class='id src_name'>src_name</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='id file'>file</span>
    <span class='id dst_name'>dst_name</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@dest_directory</span><span class='comma'>,</span> <span class='id file'>file</span>

    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id rm_rf'>rm_rf</span> <span class='id dst_name'>dst_name</span><span class='comma'>,</span> <span class='symbol'>:verbose</span> <span class='op'>=&gt;</span> <span class='id verbose'>verbose</span>
    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id mv'>mv</span> <span class='id src_name'>src_name</span><span class='comma'>,</span> <span class='ivar'>@dest_directory</span><span class='comma'>,</span> <span class='symbol'>:verbose</span> <span class='op'>=&gt;</span> <span class='id verbose'>verbose</span><span class='comma'>,</span>
                 <span class='symbol'>:force</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="make_temp_directories-instance_method">
  
    - (<tt>Object</tt>) <strong>make_temp_directories</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Make directories for index generation
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


587
588
589
590
591</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 587</span>

<span class='kw'>def</span> <span class='id make_temp_directories'>make_temp_directories</span>
  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id rm_rf'>rm_rf</span> <span class='ivar'>@directory</span>
  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id mkdir_p'>mkdir_p</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='symbol'>:mode</span> <span class='op'>=&gt;</span> <span class='int'>0700</span>
  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id mkdir_p'>mkdir_p</span> <span class='ivar'>@quick_marshal_dir</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="paranoid-instance_method">
  
    - (<tt>Object</tt>) <strong>paranoid</strong>(path, extension) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Ensure <tt>path</tt> and path with <tt>extension</tt> are identical.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


596
597
598
599
600
601
602
603</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 596</span>

<span class='kw'>def</span> <span class='id paranoid'>paranoid</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id extension'>extension</span><span class='rparen'>)</span>
  <span class='id data'>data</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id read_binary'>read_binary</span> <span class='id path'>path</span>
  <span class='id compressed_data'>compressed_data</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id read_binary'>read_binary</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id path'>path</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id extension'>extension</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>unless</span> <span class='id data'>data</span> <span class='op'>==</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id inflate'>inflate</span><span class='lparen'>(</span><span class='id compressed_data'>compressed_data</span><span class='rparen'>)</span> <span class='kw'>then</span>
    <span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Compressed file </span><span class='embexpr_beg'>#{</span><span class='id compressed_path'>compressed_path</span><span class='rbrace'>}</span><span class='tstring_content'> does not match uncompressed file </span><span class='embexpr_beg'>#{</span><span class='id path'>path</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="sanitize-instance_method">
  
    - (<tt>Object</tt>) <strong>sanitize</strong>(spec) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sanitize the descriptive fields in the spec.  Sometimes non-ASCII
characters will garble the site index.  Non-ASCII characters will be
replaced by their XML entity equivalent.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


610
611
612
613
614
615
616
617</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 610</span>

<span class='kw'>def</span> <span class='id sanitize'>sanitize</span><span class='lparen'>(</span><span class='id spec'>spec</span><span class='rparen'>)</span>
  <span class='id spec'>spec</span><span class='period'>.</span><span class='id summary'>summary</span> <span class='op'>=</span> <span class='id sanitize_string'>sanitize_string</span><span class='lparen'>(</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id summary'>summary</span><span class='rparen'>)</span>
  <span class='id spec'>spec</span><span class='period'>.</span><span class='id description'>description</span> <span class='op'>=</span> <span class='id sanitize_string'>sanitize_string</span><span class='lparen'>(</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id description'>description</span><span class='rparen'>)</span>
  <span class='id spec'>spec</span><span class='period'>.</span><span class='id post_install_message'>post_install_message</span> <span class='op'>=</span> <span class='id sanitize_string'>sanitize_string</span><span class='lparen'>(</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id post_install_message'>post_install_message</span><span class='rparen'>)</span>
  <span class='id spec'>spec</span><span class='period'>.</span><span class='id authors'>authors</span> <span class='op'>=</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id authors'>authors</span><span class='period'>.</span><span class='id collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id a'>a</span><span class='op'>|</span> <span class='id sanitize_string'>sanitize_string</span><span class='lparen'>(</span><span class='id a'>a</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

  <span class='id spec'>spec</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="sanitize_string-instance_method">
  
    - (<tt>Object</tt>) <strong>sanitize_string</strong>(string) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sanitize a single string.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


622
623
624
625
626
627
628
629
630
631
632
633
634
635</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 622</span>

<span class='kw'>def</span> <span class='id sanitize_string'>sanitize_string</span><span class='lparen'>(</span><span class='id string'>string</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id string'>string</span> <span class='kw'>unless</span> <span class='id string'>string</span>

  <span class='comment'># HACK the #to_s is in here because RSpec has an Array of Arrays of
</span>  <span class='comment'># Strings for authors.  Need a way to disallow bad values on gempsec
</span>  <span class='comment'># generation.  (Probably won't happen.)
</span>  <span class='id string'>string</span> <span class='op'>=</span> <span class='id string'>string</span><span class='period'>.</span><span class='id to_s'>to_s</span>

  <span class='kw'>begin</span>
    <span class='const'>Builder</span><span class='op'>::</span><span class='const'>XChar</span><span class='period'>.</span><span class='id encode'>encode</span> <span class='id string'>string</span>
  <span class='kw'>rescue</span> <span class='const'>NameError</span><span class='comma'>,</span> <span class='const'>NoMethodError</span>
    <span class='id string'>string</span><span class='period'>.</span><span class='id to_xs'>to_xs</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update_index-instance_method">
  
    - (<tt>Object</tt>) <strong>update_index</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Perform an in-place update of the repository from newly added gems.  Only
works for modern indicies, and sets #build_legacy to false when run.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 641</span>

<span class='kw'>def</span> <span class='id update_index'>update_index</span>
  <span class='ivar'>@build_legacy</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='id make_temp_directories'>make_temp_directories</span>

  <span class='id specs_mtime'>specs_mtime</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id stat'>stat</span><span class='lparen'>(</span><span class='ivar'>@dest_specs_index</span><span class='rparen'>)</span><span class='period'>.</span><span class='id mtime'>mtime</span>
  <span class='id newest_mtime'>newest_mtime</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id at'>at</span> <span class='int'>0</span>

  <span class='id updated_gems'>updated_gems</span> <span class='op'>=</span> <span class='id gem_file_list'>gem_file_list</span><span class='period'>.</span><span class='id select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id gem'>gem</span><span class='op'>|</span>
    <span class='id gem_mtime'>gem_mtime</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id stat'>stat</span><span class='lparen'>(</span><span class='id gem'>gem</span><span class='rparen'>)</span><span class='period'>.</span><span class='id mtime'>mtime</span>
    <span class='id newest_mtime'>newest_mtime</span> <span class='op'>=</span> <span class='id gem_mtime'>gem_mtime</span> <span class='kw'>if</span> <span class='id gem_mtime'>gem_mtime</span> <span class='op'>&gt;</span> <span class='id newest_mtime'>newest_mtime</span>
    <span class='id gem_mtime'>gem_mtime</span> <span class='op'>&gt;=</span> <span class='id specs_mtime'>specs_mtime</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id updated_gems'>updated_gems</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='kw'>then</span>
    <span class='id say'>say</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>No new gems</span><span class='tstring_end'>'</span></span>
    <span class='id terminate_interaction'>terminate_interaction</span> <span class='int'>0</span>
  <span class='kw'>end</span>

  <span class='id index'>index</span> <span class='op'>=</span> <span class='id collect_specs'>collect_specs</span> <span class='id updated_gems'>updated_gems</span>

  <span class='id files'>files</span> <span class='op'>=</span> <span class='id build_marshal_gemspecs'>build_marshal_gemspecs</span> <span class='id index'>index</span>

  <span class='const'>Gem</span><span class='period'>.</span><span class='id time'>time</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Updated indexes</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='id update_specs_index'>update_specs_index</span> <span class='id index'>index</span><span class='period'>.</span><span class='id released_gems'>released_gems</span><span class='comma'>,</span> <span class='ivar'>@dest_specs_index</span><span class='comma'>,</span> <span class='ivar'>@specs_index</span>
    <span class='id update_specs_index'>update_specs_index</span> <span class='id index'>index</span><span class='period'>.</span><span class='id released_gems'>released_gems</span><span class='comma'>,</span> <span class='ivar'>@dest_latest_specs_index</span><span class='comma'>,</span> <span class='ivar'>@latest_specs_index</span>
    <span class='id update_specs_index'>update_specs_index</span><span class='lparen'>(</span><span class='id index'>index</span><span class='period'>.</span><span class='id prerelease_gems'>prerelease_gems</span><span class='comma'>,</span> <span class='ivar'>@dest_prerelease_specs_index</span><span class='comma'>,</span>
                       <span class='ivar'>@prerelease_specs_index</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id compress_indicies'>compress_indicies</span>

  <span class='id verbose'>verbose</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id configuration'>configuration</span><span class='period'>.</span><span class='id really_verbose'>really_verbose</span>

  <span class='id say'>say</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Updating production dir </span><span class='embexpr_beg'>#{</span><span class='ivar'>@dest_directory</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id verbose'>verbose</span>

  <span class='id files'>files</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@specs_index</span>
  <span class='id files'>files</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@specs_index</span><span class='rbrace'>}</span><span class='tstring_content'>.gz</span><span class='tstring_end'>&quot;</span></span>
  <span class='id files'>files</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@latest_specs_index</span>
  <span class='id files'>files</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@latest_specs_index</span><span class='rbrace'>}</span><span class='tstring_content'>.gz</span><span class='tstring_end'>&quot;</span></span>
  <span class='id files'>files</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@prerelease_specs_index</span>
  <span class='id files'>files</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@prerelease_specs_index</span><span class='rbrace'>}</span><span class='tstring_content'>.gz</span><span class='tstring_end'>&quot;</span></span>

  <span class='id files'>files</span> <span class='op'>=</span> <span class='id files'>files</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id path'>path</span><span class='op'>|</span>
    <span class='id path'>path</span><span class='period'>.</span><span class='id sub'>sub</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='id files'>files</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id file'>file</span><span class='op'>|</span>
    <span class='id src_name'>src_name</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='id file'>file</span>
    <span class='id dst_name'>dst_name</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='ivar'>@dest_directory</span><span class='comma'>,</span> <span class='const'>File</span><span class='period'>.</span><span class='id dirname'>dirname</span><span class='lparen'>(</span><span class='id file'>file</span><span class='rparen'>)</span>

    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id mv'>mv</span> <span class='id src_name'>src_name</span><span class='comma'>,</span> <span class='id dst_name'>dst_name</span><span class='comma'>,</span> <span class='symbol'>:verbose</span> <span class='op'>=&gt;</span> <span class='id verbose'>verbose</span><span class='comma'>,</span>
                 <span class='symbol'>:force</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>

    <span class='const'>File</span><span class='period'>.</span><span class='id utime'>utime</span> <span class='id newest_mtime'>newest_mtime</span><span class='comma'>,</span> <span class='id newest_mtime'>newest_mtime</span><span class='comma'>,</span> <span class='id dst_name'>dst_name</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update_specs_index-instance_method">
  
    - (<tt>Object</tt>) <strong>update_specs_index</strong>(index, source, dest) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Combines specs in <tt>index</tt> and <tt>source</tt> then writes out a new
copy to <tt>dest</tt>.  For a latest index, does not ensure the new file is
minimal.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


703
704
705
706
707
708
709
710
711
712
713
714
715
716
717</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubygems/indexer.rb', line 703</span>

<span class='kw'>def</span> <span class='id update_specs_index'>update_specs_index</span><span class='lparen'>(</span><span class='id index'>index</span><span class='comma'>,</span> <span class='id source'>source</span><span class='comma'>,</span> <span class='id dest'>dest</span><span class='rparen'>)</span>
  <span class='id specs_index'>specs_index</span> <span class='op'>=</span> <span class='const'>Marshal</span><span class='period'>.</span><span class='id load'>load</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id read_binary'>read_binary</span><span class='lparen'>(</span><span class='id source'>source</span><span class='rparen'>)</span>

  <span class='id index'>index</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id _'>_</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='op'>|</span>
    <span class='id platform'>platform</span> <span class='op'>=</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id original_platform'>original_platform</span>
    <span class='id platform'>platform</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Platform</span><span class='op'>::</span><span class='const'>RUBY</span> <span class='kw'>if</span> <span class='id platform'>platform</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='kw'>or</span> <span class='id platform'>platform</span><span class='period'>.</span><span class='id empty?'>empty?</span>
    <span class='id specs_index'>specs_index</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='period'>.</span><span class='id version'>version</span><span class='comma'>,</span> <span class='id platform'>platform</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id specs_index'>specs_index</span> <span class='op'>=</span> <span class='id compact_specs'>compact_specs</span> <span class='id specs_index'>specs_index</span><span class='period'>.</span><span class='id uniq'>uniq</span><span class='period'>.</span><span class='id sort'>sort</span>

  <span class='id open'>open</span> <span class='id dest'>dest</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>wb</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span>
    <span class='const'>Marshal</span><span class='period'>.</span><span class='id dump'>dump</span> <span class='id specs_index'>specs_index</span><span class='comma'>,</span> <span class='id io'>io</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Mon May 16 14:19:52 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.8 (ruby-1.9.2).
</div>

  </body>
</html>